image: registry.gitlab.com/leukosio/diaas/cicd-container:2021-01-23T164930_c68d0a150f7653d6

stages: [pipeline]

variables:
  PIP_CACHE_DIR: "$CI_PROJECT_DIR/.cache/pip"
  VENV_DIR: "$CI_PROJECT_DIR/.venv"

cache:
  paths:
    - .cache/pip/
    - .venv/
    - fe/.npm/
  key: ${CI_COMMIT_REF_SLUG}

prd:
  stage: pipeline
  script:
    - (./ops/cicd/pipeline 2>&1) | ts -i | ts '%H:%M:%S'
  rules:
    - if: '$CI_COMMIT_REF_NAME == "master"'

stg:
  stage: pipeline
  script:
    - (./ops/cicd/pipeline 2>&1) | ts -i | ts '%H:%M:%S'
  rules:
    - if: "$CI_COMMIT_TAG || $CI_COMMIT_BRANCH"
