image: "registry.gitlab.com/leukosio/diaas/cicd-container:2021-01-19T220315_148d15e74f9b1ad0"

stages: [pipeline]

variables:
  PIP_CACHE_DIR: "$CI_PROJECT_DIR/.cache/pip"
  VENV_DIR: "$CI_PROJECT_DIR/.venv"

cache:
  paths:
    - .cache/pip/
    - .venv/
    - fe/.npm/
  key: ${CI_COMMIT_REF_SLUG}

prd:
  stage: pipeline
  script:
    - ./ops/cicd/pipeline
  rules:
    - if: '$CI_COMMIT_REF_NAME == "master"'

stg:
  stage: pipeline
  script:
    - ./ops/cicd/pipeline
  rules:
    - if: "$CI_COMMIT_TAG || $CI_COMMIT_BRANCH"
